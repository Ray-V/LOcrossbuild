<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Cross compiling LibreOffice for the Raspberry Pi3</title>

<!-- page -->
<style>
body {font:14px sans;max-width: 800px;padding:0px 10px;margin: 0 auto; /* center page */} 
.red {background-color: #FFdddd;}
.gray {background-color: #e7e7e7;}
.green {background-color: #e7f5e7;}
.thtwo {background-color: #Fafafa;border: dotted 1px;}
.thtwob {border: dotted 1px;}
.central {border: dashed 1px;display: inline-block;}
.appx {background-color: #Fafafa;}
.console {border-left: 3px solid lightgrey;margin-left: 15px;}
.dhash {color: #978DFF;}
.comment {color: #acacac;}
.off_rel  {color: magenta;}
div {padding: 5px;white-space: pre-wrap;}
code {font-size:12px;padding: 5px;display: inline-block;white-space: pre-wrap;margin: 5px 0;}
pre {font-size:12px;}
div code {margin: 10px 0;}
a, a:visited {text-decoration: none;font-style: oblique;color: #0000c5;}
a.extlink, a:visited.extlink {color: #c50000;}
a.intlink, a:visited.intlink {color: #00c500;}
hr {width: 100%;height: 2px;}
</style>

<!-- pop-up buttons -->
<style type="text/css">
.b_locn {border-left: 10px solid #FFdddd;padding-left: 10px;}
.b_prefs {border-left: 10px solid #e7f5e7;padding-left: 10px;}
.b_32bit {border-left: 10px solid #Fafafa;padding-left: 10px;}

/* basic for close tab */
span.tabs a {box-shadow:1px 1px 3px gray; /* shift-horz|-vert|width|colour */
border-radius:6px;padding: 2px 4px;color:#0000c5;}
span.tabs.locn a {background-color:#FFdddd;}
span.tabs.prefs a {background-color:#e7f5e7;}
span.tabs.th2 a {background-color:#Fafafa;}
span.tabs.reqd a {background-color:#E5F1FF;}
span.tabs.opt a {background-color:#e7f5e7;}

div.tab {display: none;}
div.tab:target {display: block;}
:target div.tab {display: block;}
:target div.tab + div.tab {display: none;}
</style>

<!-- nav box
Thanks to http://www.websitecodetutorials.com/code/css-nav-menus/css3-mega-drop-down-menu.php  -->
<style type="text/css">
#menu {
list-style:none;
font-weight:bold;
/* font-size: .85em;*/
}

#menu li {
position:fixed;
top:20;right:10;
background:none;
padding:5px 9px 0px 9px;
border:1px solid #e3e3e3;
border-radius:6px;
text-align:center;
z-index:1;
}

#menu a {display:block;}

/* ----------- Hide/Show Div ---------- */
#menu div {
position:fixed;
top:20;right:10;bottom:10;
max-height: 360px;
 overflow-y: auto;
 white-space: nowrap;
z-index:4;
border:1px solid #000;
font:14px;
font-weight:normal;
text-align:left; 
box-shadow:0 2px 8px #000;
border-radius:6px;
    -moz-transition: all .2s ease-in-out;
 -webkit-transition: all .2s ease-in-out;
      -o-transition: all .2s ease-in-out;
     -ms-transition: all .2s ease-in-out;
         transition: all .2s ease-in-out;
visibility:hidden;
opacity:0;
}

/* ---- CSS3 Transform Fade In/Out ----- */
#menu li:hover div {
visibility:visible;
background:#fff;
opacity:1;
}

#menu div p {padding-right:20px;}

#menu div p a {
color:darkblue;
text-decoration:none;
clear:left;
line-height:1.1;
}

#menu div a:hover, #menu div a:focus, #menu div a:active {
text-decoration:none;
color:darkred;
}

/* print styling - no nav box */
@media print {#menu { display: none;} body, p, a {color:#000; background:#fff;}}
</style>


</head><body>
<br>
<h3> Cross compiling LibreOffice for the Raspberry Pi3 </h3>
<p>
<div style="display:block;margin:auto;width:100%;max-width:600"><a class="extlink" href="https://ray-v.github.io/LO-aarch64-gui.png"><img style="display:block;margin:auto;width:100%;max-width:600;max-height:338;" alt="https://ray-v.github.io/LO-aarch64-gui.png" src="https://ray-v.github.io/LO-aarch64-gui.png"></a>... cross compiled for aarch64, running in a TDE desktop, on a RPi3.</div>
<p>
These builds are done on an x86_64 machine for the RPi3 running Slackware arm-current [armv7_hf] or Slarm64 [aarch64][<a class="extlink" href="https://www.linuxquestions.org/questions/slackware-arm-108/slarm64-aarch64-unofficial-slackware-4175613287/">history</a>][<a class="extlink" href="https://slackware.uk/slarm64/slarm64-current/slarm64/">download from a Slackware mirror</a> - for example slackware.uk where rsync is available].
<br style="margin:0 0 .5em 0">
Although this page is primarily about cross compiling LibreOffice for the RPi3, that setup is an addition to a <span class="thtwo">native&nbsp;x86_64&nbsp;build</span>, and so <span class="green">cross&nbsp;compiling</span> is shown as an addition to the native build. An i686 cross build option is included as it's an identical setup to the arm cross builds.
<br style="margin:0 0 .5em 0">
There are therefore four build options - native x86_64; cross armv7, aarch64, or i686.
<br style="margin:0 0 .5em 0">
The page has been laid out so that the contents can be copied and pasted into a console allowing a step-by-step build to aid troubleshooting.
<p><br>
<b>LO build environment</b><br>
<code>/LO_build
├── libreoffice-x.x.x.x			build from source tarballs
├── external_tarballs			source archives for non-system build requirements
├── pkg-$Arch				DESTDIR for packaging installation
<span class="green">└── LO-$Arch-sysroot			installation directory for HOST libs and headers</span></code>
<p>
With the exception of these initial downloads, the non-system sources will be downloaded during 'make'.
<p>
<code class="thtwo">cd /LO_build/
export LO_VERSION=<span class="comment">6.3.3.2</span>
</code>
<p><br>
<b>Build from tarballs</b>
<br>
&nbsp;&nbsp;download
<br>
<code class="thtwo">(cd external_tarballs
SRC_URL=https://download.documentfoundation.org/libreoffice/src
DIR=$(echo $LO_VERSION | cut -d "." -f1-3)

<span style="color: #c50000;">wget $SRC_URL/$DIR/libreoffice-$LO_VERSION.tar.xz
wget $SRC_URL/$DIR/libreoffice-dictionaries-$LO_VERSION.tar.xz
wget $SRC_URL/$DIR/libreoffice-help-$LO_VERSION.tar.xz
wget $SRC_URL/$DIR/libreoffice-translations-$LO_VERSION.tar.xz</span>)
</code>
<br>
&nbsp;&nbsp;extract
<br>
<code class="thtwo">tar xf external_tarballs/libreoffice-$LO_VERSION.tar.xz

<span class="dhash">##</span> uncompress any of the submodule tarballs now if they need patching - for example:
<code class="thtwo">tar xf external_tarballs/libreoffice-translations-$LO_VERSION.tar.xz

<span class="dhash">##</span> apply patch
(cd libreoffice-$LO_VERSION/translations/source/en-GB/helpcontent2/source/text/scalc/
line_no=$(grep -n "msgstr.*COLOR function" 01.po | cut -d: -f1)
sed -i "${line_no}s|COLOR|COLOUR|" 01.po)

<span class="dhash">##</span> let the build know that the submodule has been unpacked &hellip;
mkdir -p libreoffice-$LO_VERSION/src/libreoffice-translations-$LO_VERSION
</code>

cd libreoffice-$LO_VERSION
</code>

<p><br>
<b>Native build</b> - variables will be overwritten if cross compiling
<br>
Set the configure option --host == --build [using the autotools definition of host - the machine the compiled code will run on]
<br>
<code class="thtwo">export HOST=$(bash ./config.guess)
export Arch=x86_64
export STRIP=strip
</code>
<br>
Gcc optimization
<code class="thtwo"><span class="dhash">##</span> for build machine, for native x86_64 or cross i686 builds, for LO to run on same machine architecture
export OPTM=$(echo $(gcc -Q -O2 -march=native --help=target | grep -E "^  -march=|^  -mtune=|^  -mfpmath=" | tr -d [:blank:]))

<span class="dhash">##</span> or set manually for the intended x86 host machine
<span class="dhash">##</span> export OPTM=

export CC="gcc ${OPTM:-}"
export CXX="g++ ${OPTM:-}"
</code>

<p>
</code> <a name="close_LO_xcompile"></a>                         <!-- LO xcompile - start -->
<span class="tabs prefs"><a href="#LO_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;setting up for cross compiling</span>
<div id="LO_xcompile" class="tab"><div class="b_prefs"><span class="tabs th2"><a href="#close_LO_xcompile">close</a></span>
<!-- leave this space -->
<b>The toolchain</b> used is the custom built gcc cross compiler <a class="extlink" href="https://ray-v.github.io/tde-slackbuilds/cross-compiling-TDE-for-the-RPi3.html#gcc_x">here</a>,
   which includes some compiler optimizations, and creating a kernel headers package.

This is the installtion tree for that cross-compiler and sysroot.
The intention is that the cross tools are contained within one directory and can be installed/mounted only when required.
sysroot libs and headers can be permanently installed within the cross-compiler tree or bind mounted from another media or directory.
<code>/opt
└── cross-pi-gcc			cross tools
    └── sysroot 			location defined in x-tools build</code>
Set the cross tools directories
<code class="green">export XGCC_DIR=/opt/cross-pi-gcc
export SYSROOT=$XGCC_DIR/sysroot
</code>

<b>[1] Set variables</b> for an armv7, aarch64, or i686 build.
<code class="thtwob"><b>32-bit</b> armv7_hf
<code class="green">export HOST=arm-linux-gnueabihf
export Arch=armv7
export STRIP=$HOST-strip
<span class="dhash">##</span> the cross compiler has been built with arm_hf optimizations
export CC=$HOST-gcc
export CXX=$HOST-g++
export LIBDIRSUFFIX=""
<span class="dhash">##</span> Slack_base = where the Slackware packages a-y directories are
export Slack_base=<span class="comment">/path_to_Slackware_arm_current</span>
</code>
Error:
<code class="console">/LO_build/libreoffice-6.3.3.2/sal/osl/unx/process_impl.cxx:108:14: error: ‘PATH_MAX’ was not declared in this scope</code>
&hellip; and others &hellip;

Add linux/limits.h which defines PATH_MAX:
<code class="green">sed -i 's|limits.h>|&amp;\n#include &lt;linux/limits.h>|' {sal/osl/unx/process_impl.cxx,cppuhelper/source/findsofficepath.c,desktop/unx/source/start.c,vcl/unx/generic/fontmanager/helper.cxx,uui/source/logindlg.cxx}
sed -i 's|MSVC|&amp;\n#include &lt;linux/limits.h>|' pyuno/source/loader/pyuno_loader.cxx
</code>
</code>
<b>OR:</b>
<code class="thtwob"><b>64-bit</b> aarch64
<code class="green">export HOST=aarch64-linux-gnu
export Arch=aarch64
export STRIP=$HOST-strip
<span class="dhash">##</span> -march=armv8-a+crc is the default compiler optimization, so just add -mtune=cortex-a53
export CC="$HOST-gcc -mtune=cortex-a53"
export CXX="$HOST-g++ -mtune=cortex-a53"
export LIBDIRSUFFIX=64
<span class="dhash">##</span> Slack_base = where the Slarm64 packages a-y directories are
export Slack_base=<span class="comment">/path_to_Slarm64</span>
</code>
</code>
<b>OR:</b>
<code class="thtwob"><b>32-bit</b> x86 - i686
<code class="green">export HOST=i686-linux-gnu
export Arch=i686
export STRIP=$HOST-strip
export CC="$HOST-gcc ${OPTM:-}"
export CXX="$HOST-g++ ${OPTM:-}"
export LIBDIRSUFFIX=""
<span class="dhash">##</span> build can't find 'libssp.so.0', which Slackware doesn't include
export LD_LIBRARY_PATH=$XGCC_DIR/$HOST/lib
<span class="dhash">##</span> Slack_base = where the Slackware packages a-y directories are
export Slack_base=<span class="comment">/path_to_Slackware32_current</span>
</code>
</code>


<b>[2] Cross compiler</b>

Install cross tools
<code class="green">installpkg <span class="comment">/tmp/</span>xgcc910-glibc2.29-<span class="comment">&lt;for_Arch></span>.txz
</code>
To avoid any issues with the different limits.h priorities producing this error:
<code class="console">.../include/bits/stdlib.h:90:3: error: #error "Assumed value of MB_LEN_MAX wrong"</code>
use the work-around as detailed <a class="extlink" href="https://www.linuxquestions.org/questions/linux-software-2/tar-cross-compile-error-arm-linux-gnueabi-4175642648/#post5929952">here</a>.
<code class="green">(cd $XGCC_DIR/lib/gcc/*-linux-gnu*/9.1.0/plugin/include/
cat limitx.h glimits.h limity.h > ../../include-fixed/limits.h)
</code>

Location of installed HOST libs and headers
<code class="green">export HOST_INSTN=/LO_build/LO-$Arch-sysroot
</code>


<b>[3] Set up a sysroot</b> for the HOST libs and headers needed for the LibreOffice build.
     <b>OR</b> skip this and just mount the media containing the HOST installation to $SYSROOT

My preference is to set this up in a separate directory and bind-mount it to the cross compiler sysroot directory.
This enables me to set up different sysroots for whatever is being cross compiled.
</code>
Install kernel headers and Slackware or Slarm64 libs/headers to a <i>HOST_installation directory</i>
<code class="green">export ROOT=$HOST_INSTN
installpkg <span class="comment">/tmp/</span>kernel-headers-<span class="comment">&lt;for_Arch></span>.txz

cd $Slack_base
installpkg a/bzip2-*.txz
installpkg a/dbus-*.txz
installpkg a/util-linux-*.txz
installpkg a/xz-*.txz
installpkg ap/cups-*.txz
installpkg ap/sqlite-*.txz
installpkg d/gcc-9.1.0-*.txz
installpkg d/gcc-g++-9.1.0-*.txz
installpkg d/python-2.*.txz
installpkg d/python3-*.txz
installpkg l/at-spi2-atk-*.txz
installpkg l/at-spi2-core-*.txz
installpkg l/atk-*.txz
installpkg l/cairo-*.txz
installpkg l/expat-*.txz
installpkg l/freetype-*.txz
installpkg l/fribidi-*.txz
installpkg l/gdk-pixbuf2-*.txz
installpkg l/glib2-*.txz
installpkg l/gmp-*.txz
installpkg l/graphite2-*.txz
installpkg l/gtk+2-*.txz
installpkg l/gtk+3-*.txz
installpkg l/harfbuzz-*.txz
installpkg l/icu4c-*.txz
installpkg l/libffi-*.txz
installpkg l/libidn2-*.txz
installpkg l/libpng-1.6.*.txz
installpkg l/libunistring-0.9.*.txz
installpkg l/libxml2-*.txz
installpkg l/libxslt-*.txz
installpkg l/mozilla-nss-*.txz
installpkg l/pango-*.txz
installpkg l/pcre-*.txz
installpkg l/shared-mime-info-*.txz
installpkg l/zlib-*.txz
installpkg n/gnutls-*.txz
installpkg n/nettle-*.txz
installpkg n/p11-kit-*.txz
installpkg x/fontconfig-*.txz
installpkg x/libICE-*.txz
installpkg x/libSM-*.txz
installpkg x/libX11-*.txz
installpkg x/libXau-*.txz
installpkg x/libXcomposite-*.txz
installpkg x/libXcursor-*.txz
installpkg x/libXdamage-*.txz
installpkg x/libXdmcp-*.txz
installpkg x/libXext-*.txz
installpkg x/libXfixes-*.txz
installpkg x/libXi-*.txz
installpkg x/libXinerama-*.txz
installpkg x/libXrandr-*.txz
installpkg x/libXrender-*.txz
installpkg x/libXtst-*.txz
installpkg x/libXxf86vm-*.txz
installpkg x/libdrm-*.txz
installpkg x/libepoxy-*.txz
installpkg x/libglvnd-*.txz
installpkg x/libpthread-stubs-*.txz
installpkg x/libxcb-*.txz
installpkg x/mesa-*.txz
installpkg x/pixman-*.txz
installpkg x/xorgproto-*.txz

<span class="dhash">##</span> move ldconfig out of the way - links will be set up by doinst.sh
mv /sbin/ldconfig /sbin/ldconfig-bak
installpkg l/glibc-2.29*.txz
mv /sbin/ldconfig-bak /sbin/ldconfig
unset ROOT
cd -
</code>


<b>[4]</b> Mount HOST_installation directory to SYSROOT
<code class="green">mount -B $HOST_INSTN $SYSROOT
</code>


<b>[5] Set up shell variables</b>
Create a wrapper script for pkg-config which needs to access the libs and headers for the host system. This script sets it up to prefix $SYSROOT to the -L and -I paths in the .pc files.
Exclude coinmp which uses &lt;tuple>-pkg-config in its configure script to define paths in its source code and hence prefixes SYSROOT to those paths. This script will then run with the native PKG_CONFIG_* variables for coinmp.
<code class="green">echo $"[[ ! \$PKG_CONFIG_PATH == *CoinUtils* ]] &amp;&amp; {
export PKG_CONFIG_PATH=
export PKG_CONFIG_SYSROOT_DIR=$SYSROOT
export PKG_CONFIG_LIBDIR=$SYSROOT/usr/lib$LIBDIRSUFFIX/pkgconfig
}
exec pkg-config \"\$@\"" > $XGCC_DIR/bin/$HOST-pkg-config

chmod 700 $XGCC_DIR/bin/$HOST-pkg-config
</code>
Ref: README.cross - set PYTHON_CFLAGS [Python2]
<code class="green">export PY_INC=$(python -c "import distutils.sysconfig; print(distutils.sysconfig.get_config_var('INCLUDEPY'));")

export PYTHON_CFLAGS=-I$SYSROOT$PY_INC
export PYTHON_LIBS=-l$(echo $PY_INC | rev | cut -d "/" -f 1 | rev )
<span class="appx"><span class="dhash">##</span> Check:
echo $PYTHON_CFLAGS
echo $PYTHON_LIBS</span>
</code>
Add cross tools binaries to the PATH
<code class="green">export PATH=$XGCC_DIR/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin
</code>


<b>[6]</b> Replace RepositoryModule_build.mk module list with that from RepositoryModule_host.mk.
This probably increases the build time by including unnecessary BUILD platform modules in the build, but to-date I haven't found an alternative to avoid the string of errors, for example:
<code class="console">.../libreoffice-6.3.0.4/solenv/gbuild/ComponentTarget.mk:50: *** No LIBFILENAME set at component target: .../libreoffice-6.3.0.4/workdir_for_build/ComponentTarget/animations/source/animcore/animcore.component.  Stop.</code>
&hellip; and &hellip;
<code class="console">.../libreoffice-6.3.0.4/solenv/gbuild/LinkTarget.mk:687: *** used LinkTarget Library/libopencllo.so not defined.  Stop.</code>
etc &hellip;

The build time on a dual core 2.2GHz machine is 15+ hours for the cross compilation.
<code class="green"><span class="dhash">##</span> Test for this having been done already if this is a second build:
[[ ! -s RepositoryModule_build.mk-original ]] &amp;&amp; {
mv RepositoryModule_build.mk RepositoryModule_build.mk-original
<span class="dhash">##</span> .. delete from ..
sed '/add_moduledirs/q' RepositoryModule_build.mk-original > RepositoryModule_build.mk
<span class="dhash">##</span> .. print section (inclusive)
sed -n '/accessibility/,/xmlsecurity/p' RepositoryModule_host.mk >> RepositoryModule_build.mk
<span class="dhash">##</span> .. print from (inclusive)
sed -n '/^))/,$p' RepositoryModule_build.mk-original >> RepositoryModule_build.mk
}
</code>

<li>To cross compile for the other architectures after this build, see <a href="#LO_xcompile2"><span class="thtwob">Cross compiling 2</span></a></li>

<span class="tabs th2"><a href="#close_LO_xcompile">close</a></span>
</div></div>                                                     <!-- LO xcompile - end -->
<p>
Configure options are set with <i>CONFIGURE_OPTS</i>, rather than in an <i>autogen.input</i> file, for inclusion in the cross compilation <i><b>-&NoBreak;-&NoBreak;with-&NoBreak;build-&NoBreak;platform-&NoBreak;configure-&NoBreak;options</b></i> parameter. The vcl plugins gen, gtk[2], and gtk3 are included in the build.
<br>
Installation is to $DESTDIR for packaging where the prefix for the installed package is set.
<p>
<code class="thtwo">NUMJOBS=6 &amp;&amp; [[ $(getconf _NPROCESSORS_ONLN) -ge 4 ]] &amp;&amp; export NUMJOBS=$[$(getconf _NPROCESSORS_ONLN)*2]
LOCN=<span class="comment">en-GB</span>
</code>
<code>--with-lang=$LOCN    =>  includes translations submodule
--with-help          =>  includes helpcontent2 submodule => adds $LOCN to off-line help
--with-myspell-dicts =>  includes dictionaries submodule for spellcheck</code>
<code class="thtwo">export CONFIGURE_OPTS="
--prefix=/
--disable-postgresql-sdbc
--without-java
--without-junit
--disable-odk
--without-krb5
--without-gssapi
--disable-gstreamer-0-10
--disable-gstreamer-1-0
--disable-epm
--enable-release-build
--with-parallelism=$NUMJOBS
--with-locales=$LOCN
--with-lang=$LOCN
--with-help
--with-myspell-dicts
--with-external-tar=/LO_build/external_tarballs
--with-system-libatomic_ops
--with-system-nss
--with-system-libpng
--with-theme=colibre"
</code>
<p>
Patch for error:
<br>
<code class="console">.../RepositoryModule_build.mk:12: *** Module does not exist: .../mysqlc/Module_mysqlc.mk.  Stop.
</code>
<br>
<code class="thtwo">sed -i '/mysqlc/d ' RepositoryModule_build.mk
</code>
<p>
The build needs plenty of ram and the only way to avoid freezing the build machine may be to enable an additional chunk of swap &hellip;
<br>
<code class="thtwo">swapon &lt;additional-swap-partition>
</code>

<p><br>
<b>Building</b>
<br>
When running ./autogen.sh &hellip;
<p>
<b><u>Native</u></b>:
<br>
&hellip; <i><b>host_alias == build_alias</b></i>, which is set by config.guess; the cross-compiling check will be 'no'; and <i><b>-&NoBreak;-&NoBreak;with-&NoBreak;build-&NoBreak;platform-&NoBreak;configure-&NoBreak;options</b></i> will be ignored.
<p>
<b><u>Cross</u></b>:
<br>
&hellip; <i><b>host_alias != build_alias</b></i>; the cross-compiling check will be 'yes'; and <i><b>-&NoBreak;-&NoBreak;with-&NoBreak;build-&NoBreak;platform-&NoBreak;configure-&NoBreak;options</b></i> will be used, using or overriding any set for the host platform.
<p>
b] For an armv7 cross build, with PYTHON_CFLAGS for the HOST building environment pointing to SYSROOT, this error occurs:
<br>
<code class="console"> pyport.h ... #error "LONG_BIT definition appears wrong for platform (bad gcc/glibc config?)."</code>
<span style="background-color:#FFe0ef">PYTHON_CFLAGS</span> needs to be set separately for the BUILD platform headers.
<p>
c] <i><b>-&NoBreak;-&NoBreak;with-&NoBreak;build-&NoBreak;platform-&NoBreak;configure-&NoBreak;options</b></i>
<br>
This extract is the section in ./configure which determines the options applying to the BUILD platform build.
<br>
They are hard-coded and override any set in CONFIGURE_OPTS and will in turn be overridden by any that follow in <i>-&NoBreak;-&NoBreak;with-&NoBreak;build-&NoBreak;platform-&NoBreak;configure-&NoBreak;options &DoubleRightArrow; sub_conf_opts</i>
<br>
<code>    sub_conf_opts="$sub_conf_opts $with_build_platform_configure_options"
    # Don't bother having configure look for stuff not needed for the build platform anyway
    ./configure \
        --disable-cups \
        --disable-gstreamer-1-0 \
        --disable-gstreamer-0-10 \
        --disable-gtk \
        --disable-gtk3 \
        --disable-pdfimport \
        --disable-postgresql-sdbc \
        --with-parallelism="$with_parallelism" \
        --without-doxygen \
        --without-java \
        $sub_conf_opts \
        --srcdir=$srcdir \
        2>&amp;1
</code>
<br>
<code class="thtwo">./autogen.sh $CONFIGURE_OPTS --host=$HOST <span style="background-color:#fff0f3"><b>--with-build-platform-configure-options</b>="$CONFIGURE_OPTS <span style="background-color:#FFe0e5">PYTHON_CFLAGS=-I$PY_INC</span> --without-help --without-system-dicts"</span> | tee /LO_build/autogen-log-$Arch--$(date +%h_%d_%H:%M)

sed -i 's|check-if-root ||' Makefile

make build-nocheck | tee /LO_build/make-log-$Arch--$(date +%h_%d_%H:%M)
</code>

<br>
Install to packaging area
<br>
<code class="thtwo">DESTDIR=/LO_build/pkg-$Arch make install | tee /LO_build/install-log-$Arch--$(date +%h_%d_%H:%M)
</code>
<br>
Remove unwanted dictionaries and help files, leaving just $LOCN
<br>
<code class="thtwo">rm -rf /LO_build/pkg-$Arch/lib/libreoffice/share/extensions/dict-es
rm -rf /LO_build/pkg-$Arch/lib/libreoffice/share/extensions/dict-fr
rm -rf /LO_build/pkg-$Arch/lib/libreoffice/help/en-US
</code>

<br>
Remove more unwanted stuff, leaving just en
<br>
<code class="thtwo">ls /LO_build/pkg-$Arch/lib/libreoffice/share/{autocorr/*.dat,fingerprint/*lm,numbertext/*sor} | grep -vE "$LOCN|en.lm|en.sor|Roman" \
| while read line
do
rm $line
done
</code>

<br>
Strip binaries
<br>
<code class="thtwo">find /LO_build/pkg-$Arch | xargs file | grep -e "executable" -e "shared object" | grep ELF | cut -f 1 -d : | xargs $STRIP --strip-unneeded
</code>

<br>
Create package to install to /opt/libreoffice
<br>
<code class="thtwo">mkdir -p /LO_build/pkg-$Arch/pkg/opt
mv /LO_build/pkg-$Arch/lib/libreoffice /LO_build/pkg-$Arch/pkg/opt
cd /LO_build/pkg-$Arch/pkg

[[ $Arch == i686 ]] &amp;&amp; cp $XGCC_DIR/$HOST/lib/libssp.so.0.0.0 opt/libreoffice/program/libssp.so.0

makepkg -l y -c n /LO_build/libreoffice-$LO_VERSION-$Arch-1.txz
</code>

<p><br>

</code> <a name="close_LO_xcompile2"></a>                        <!-- LO xcompile2 - start -->
<span class="tabs prefs"><a href="#LO_xcompile2">Cross compiling 2</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;continuing for the other architectures &hellip;</span>
<div id="LO_xcompile2" class="tab"><div class="b_prefs"><span class="tabs th2"><a href="#close_LO_xcompile2">close</a></span>
<!-- leave this space -->
The cross compilation builds for the BUILD platform as well as the HOST platform.
<code>/LO_build
├── libreoffice-6.3.3.2
│   ├── workdir_for_build
    ├── workdir			# for host build
    .
    ├── instdir_for_build
    ├── instdir			# for host build
</code>
That BUILD platform data can be used for a further HOST platform build, for example build for aarch64 after an armv7 build.
<code>x86_64 BUILD platform build &DoubleRightArrow; armv7 HOST platform build &DoubleRightArrow; armv7 package
                            &rdsh; remove HOST compiled data &hellip;
                            &rdsh; aarch64 HOST platform build &DoubleRightArrow; aarch64 package
                            <span class="comment">&rdsh; remove HOST compiled data &hellip;
                            &rdsh; i686 HOST platform build &DoubleRightArrow; i686 package</span>
</code>
This can result in a significant time saving - built on a 2x quad-core 3GHz machine, the initial armv7 build was ~196 minutes, and by retaining the 'workdir_for_build' and the 'instdir_for_build', the build time was halved for an aarch64 build to ~103 minutes. An x86_64 native only build was ~107 minutes.

<b>[1] (Re)move</b> previous host data:
<code class="green">cd /LO_build/libreoffice-$LO_VERSION
mv workdir workdir-$Arch
mv instdir instdir-$Arch

umount $SYSROOT
mv $XGCC_DIR $XGCC_DIR-$Arch
</code>

<b>[2] Set up cross compile</b> for <a href="#LO_xcompile">the other architecture</a>
and continue through to 'makepkg'

<span class="tabs th2"><a href="#close_LO_xcompile2">close</a></span>
</div></div>                                                     <!-- LO xcompile2 - end -->

<hr class="comment">
<b>Usage options</b>
<br>
To show Tip-of-the-Day each time LO is started,
<br>
run with gtk2 vcl plugin,
<br>
start with Calc,
<br>
and avoid the banners for Release Notes and Donate links which are at:
<br>
<code class="console">https://hub.libreoffice.org/ReleaseNotes/?LOvers=6.3&amp;LOlocale=en
https://hub.libreoffice.org/donation/?BCP47=en-GB&amp;LOlang=en</code>
<br>
Initially, before running LO for the first time, &hellip;
<code class="thtwo">mkdir -p ~/.config/libreoffice/4/user/
echo '&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;oor:items xmlns:oor="http://openoffice.org/2001/registry" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
&lt;item oor:path="/org.openoffice.Office.Common/Misc">&lt;prop oor:name="FirstRun" oor:op="fuse">&lt;value>false&lt;/value>&lt;/prop>&lt;/item>
&lt;item oor:path="/org.openoffice.Office.Common/Misc">&lt;prop oor:name="LastTipOfTheDayShown" oor:op="fuse">&lt;value>0&lt;/value>&lt;/prop>&lt;/item>
&lt;item oor:path="/org.openoffice.Setup/Product">&lt;prop oor:name="LastTimeDonateShown" oor:op="fuse">&lt;value>0&lt;/value>&lt;/prop>&lt;/item>
&lt;item oor:path="/org.openoffice.Setup/Product">&lt;prop oor:name="ooSetupLastVersion" oor:op="fuse">&lt;value>6.3&lt;/value>&lt;/prop>&lt;/item>
&lt;/oor:items>' > ~/.config/libreoffice/4/user/registrymodifications.xcu
</code>
then for each new start &hellip;
<code class="thtwo">sed -i 's|LastTipOfTheDayShown.*$|LastTipOfTheDayShown" oor:op="fuse">&lt;value>0&lt;/value>&lt;/prop>&lt;/item>|;s|LastTimeDonateShown.*$|LastTimeDonateShown" oor:op="fuse">&lt;value>0&lt;/value>&lt;/prop>&lt;/item>|' ~/.config/libreoffice/4/user/registrymodifications.xcu

SAL_USE_VCLPLUGIN=gtk /opt/libreoffice/program/soffice --calc
</code>
<p>
When running LO 6.3.3.2 with the gen or gtk vcl plugin, the Tip of the Day text doesn't wrap in the dialog box if the text is selectable - my preference is wrapping text, so until <a class="extlink" href="https://bugs.documentfoundation.org/show_bug.cgi?id=128524">bug 128524</a> is resolved:
<br>
<code class="thtwo">sed -i 's|selectable">True|selectable">False|' /opt/libreoffice/share/config/soffice.cfg/cui/ui/tipofthedaydialog.ui
</code>
<hr class="comment">
<span class="comment">To clone this page from Github:<br>
<code style="font-style:italic">git clone https://github.com/Ray-V/LOcrossbuild.git
cd LOcrossbuild
git checkout gh-pages
</code></span>

</body></html>
